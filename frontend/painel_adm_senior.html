<!doctype html>
<html lang="pt-BR">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Painel ADM S√™nior ‚Äî Gest√£o de Monitores</title>
    <style>
      /* Reset e fontes */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', Roboto, sans-serif;
      }

      body {
        background: linear-gradient(135deg, #003366, #4f46e5);
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        color: #333;
        padding: 16px;
      }

      header, main, footer {
        width: 100%;
        max-width: 920px;
      }

      header {
        text-align: center;
        color: white;
        margin-bottom: 24px;
      }

      header h1 {
        font-size: 24px;
        letter-spacing: 0.5px;
      }

      main {
        background: white;
        padding: 28px;
        border-radius: 14px;
        box-shadow: 0 6px 16px rgba(0, 0, 0, 0.18);
        text-align: center;
        width: 100%;
        min-width: 320px;
      }

  /* torna a tabela rol√°vel horizontalmente em telas menores e evita estouro do cart√£o */
  main > table { display: block; width: 100%; overflow-x: auto; white-space: nowrap; margin-top: 20px; }
  table { border-collapse: collapse; width: 100%; }
      th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
      th { background-color: #f58403; color: white; }
      tr:hover { background-color: #f5f5f5; }
      button { padding: 6px 12px; margin: 2px; cursor: pointer; }
      .btn-promover { background-color: #2196F3; color: white; border: none; }
      .btn-rebaixar { background-color: #ff9800; color: white; border: none; }
      .btn-desativar { background-color: #F01F23; color: white; border: none; }
      .btn-adicionar { background-color: #F01F23; color: white; border: none; padding: 10px 20px; margin: 20px 0; }

      /* pequenas telas/tablets */
      @media (max-width: 740px) {
        header h1 { font-size: 22px; }
        main { padding: 20px; border-radius: 12px; }
        input, button { font-size: 15px; }
      }

      /* responsividade para mobile (<= 600px) */
      @media (max-width: 600px) {
        header, main, footer { max-width: 100%; }
        body { padding: 10px; }
        header h1 { font-size: 20px; line-height: 1.2; }
        main { padding: 14px; border-radius: 10px; }

        /* tornar bot√£o de adicionar full-width e mais toc√°vel */
        .btn-adicionar { width: 100%; padding: 12px 14px; margin: 12px 0; box-sizing: border-box; }

        /* tabela responsiva: reduzir padding e fonte; permitir scroll horizontal */
        table, th, td { font-size: 13px; }
        th, td { padding: 8px; }
        main > table { margin-top: 12px; }

        /* reduzir espa√ßos nos bot√µes das a√ß√µes */
        button { padding: 8px 10px; font-size: 13px; }
      }
    </style>
  </head>
<body>
  <header>
    <h1>Painel de Gest√£o ‚Äî Savepoint Ludoteca</h1>
  </header>

  <main>
    <section aria-labelledby="gestao-monitores">
      <h2 id="gestao-monitores">Gest√£o de Monitores</h2>

      <button class="btn-adicionar" id="btn-novo-monitor">+ Adicionar Novo Monitor</button>

      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Nome</th>
            <th>Email</th>
            <th>N√≠vel</th>
            <th>Data Cadastro</th>
            <th>A√ß√µes</th>
          </tr>
        </thead>
        <tbody id="tabela-monitores">
          <!-- Monitores aparecer√£o aqui -->
        </tbody>
      </table>
    </section>
  </main>

  <footer>
    <small>¬© Savepoint Ludoteca</small>
  </footer>

  <script>
    const API_BASE = 'http://localhost:3000/api';

    async function carregarMonitores() {
      try {
        const response = await fetch(`${API_BASE}/monitor`);
        const data = await response.json();
        renderMonitores(data.monitores || []);
      } catch (error) {
        console.error('Erro ao carregar monitores:', error);
        document.getElementById('tabela-monitores').innerHTML = 
          '<tr><td colspan="6" style="color: red;">Erro ao carregar monitores</td></tr>';
      }
    }

    function renderMonitores(monitores) {
      const tbody = document.getElementById('tabela-monitores');
      tbody.innerHTML = '';

      if (monitores.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6">Nenhum monitor cadastrado</td></tr>';
        return;
      }

      monitores.forEach(m => {
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${m.id}</td>
          <td>${m.nome}</td>
          <td>${m.email}</td>
          <td>${m.nivel === 'admin_senior' ? '‚≠ê Admin S√™nior' : 'üë§ Admin'}</td>
          <td>${new Date(m.data_cadastro).toLocaleDateString('pt-BR')}</td>
          <td>
            ${m.nivel === 'admin' ? 
              `<button class="btn-promover" onclick="promover(${m.id})">Promover a S√™nior</button>` :
              `<button class="btn-rebaixar" onclick="rebaixar(${m.id})">Rebaixar a Admin</button>`
            }
            <button class="btn-desativar" onclick="desativar(${m.id})">Desativar</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    // Adicionar novo monitor
    document.getElementById('btn-novo-monitor').addEventListener('click', async () => {
      const nome = prompt('Nome do monitor:');
      if (!nome) return;
      
      const email = prompt('Email do monitor:');
      if (!email) return;
      
      const senha = prompt('Senha:');
      if (!senha) return;
      
      const nivel = confirm('√â Admin S√™nior?') ? 'admin_senior' : 'admin';
      
      try {
        const response = await fetch(`${API_BASE}/monitor`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nome, email, senha, nivel })
        });
        
        const data = await response.json();
        
        if (response.ok) {
          alert('Monitor cadastrado com sucesso!');
          carregarMonitores();
        } else {
          alert('Erro: ' + data.error);
        }
      } catch (error) {
        alert('Erro ao cadastrar monitor');
      }
    });

    async function promover(id) {
      if (!confirm('Promover este monitor a Admin S√™nior?')) return;
      
      try {
        const response = await fetch(`${API_BASE}/monitor/${id}/nivel`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nivel: 'admin_senior' })
        });
        
        if (response.ok) {
          alert('Monitor promovido!');
          carregarMonitores();
        }
      } catch (error) {
        alert('Erro ao promover');
      }
    }

    async function rebaixar(id) {
      if (!confirm('Rebaixar este monitor a Admin?')) return;
      
      try {
        const response = await fetch(`${API_BASE}/monitor/${id}/nivel`, {
          method: 'PUT',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nivel: 'admin' })
        });
        
        if (response.ok) {
          alert('Monitor rebaixado!');
          carregarMonitores();
        }
      } catch (error) {
        alert('Erro ao rebaixar');
      }
    }

    async function desativar(id) {
      if (!confirm('Desativar este monitor?')) return;
      
      try {
        const response = await fetch(`${API_BASE}/monitor/${id}`, {
          method: 'DELETE'
        });
        
        if (response.ok) {
          alert('Monitor desativado!');
          carregarMonitores();
        }
      } catch (error) {
        alert('Erro ao desativar');
      }
    }

    // Carregar monitores ao iniciar
    carregarMonitores();
  </script>
</body>
</html>
